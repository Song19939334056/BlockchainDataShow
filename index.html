<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
</head>

<body>
    <div class="page_header">
        <div class="header_content">
            <div class="h_c_logo">
                <span>LOGO</span>
            </div>
            <div class="h_c_tabs">
                <span>首页</span>
                <span>|</span>
                <span>最新活动</span>
                <span>|</span>
                <span>公司产品</span>
                <span>|</span>
                <span>企业中心</span>
                <span>|</span>
                <span>开发者</span>
                <span>|</span>
                <span>客户支持</span>
                <span>|</span>
                <span>合作与生态</span>
            </div>
        </div>
    </div>
    <div class="page_content">
        <div class="content_title">
            <div class="c_t">当前区块高度</div>
        </div>
        <div class="content_banner">
            <div class="c_b_content">
                <div class="c_b_out">
                    <div class="c_b_img_big">
                        <div class="c_b_img">
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                            <div>
                                <img class="work_class" src="./asstes/1.png" title="">
                            </div>
                            <div>
                                <img class="work_class_point" src="./asstes/2.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="c_b_number">
                    0
                </div>
            </div>
        </div>
        <div class="content_dataMap">
            <div class="c_d_point1">
                <img src="./asstes/6.png" style="height:100%;width: 100%;" alt="">
            </div>
            <div class="c_d_point2">
                <img src="./asstes/5.png" style="height:100%;width: 100%;" alt="">
            </div>
            <div class="c_d_point3">
                <img src="./asstes/5.png" style="height:100%;width: 100%;" alt="">
            </div>
            <div class="c_d_point4">
                <img src="./asstes/6.png" style="height:100%;width: 100%;" alt="">
            </div>
            <div class="c_d_content">
                <div class="c_d_top">
                    <img src="./asstes/3.png" style="width: 100%;" alt="">
                </div>
                <div class="c_d_left">
                    <img src="./asstes/3.png" style="width: 100%;" alt="">
                </div>
                <div class="c_d_right">
                    <img src="./asstes/3.png" style="width: 100%;" alt="">
                </div>
                <div class="c_d_bottom">
                    <img src="./asstes/3.png" style="width: 100%;" alt="">
                </div>
                <div class="c_d_woman">
                    <img src="./asstes/8.png" style="height:100%;width: 100%;" alt="">
                </div>
                <div class="c_d_man">
                    <img src="./asstes/9.png" style="height:100%;width: 100%;" alt="">
                </div>
                <div class="c_d_gd1">
                    <img src="./asstes/光点.png" style="height:100%;width: 100%;" alt="">
                </div>
                <div class="c_d_gd2">
                    <img src="./asstes/光点.png" style="height:100%;width: 100%;" alt="">
                </div>
                <div class="c_d_gd3">
                    <img src="./asstes/光点.png" style="height:100%;width: 100%;" alt="">
                </div>
                <div class="c_d_textborder textborder1">
                    <div class="c_d_blockNumber">区块高度：<span class="c_d_blockNumber_number">0</span></div>
                    <div class="c_d_nodeId"><span class="c_d_blockNumber_nodeId">1</span></div>
                    <div class="s_j"></div>
                </div>
                <div class="c_d_textborder textborder2">
                    <div class="c_d_blockNumber">区块高度：<span class="c_d_blockNumber_number">0</span></div>
                    <div class="c_d_nodeId"><span class="c_d_blockNumber_nodeId">2</span></div>
                    <div class="s_j"></div>
                </div>
                <div class="c_d_textborder textborder3">
                    <div class="c_d_blockNumber">区块高度：<span class="c_d_blockNumber_number">0</span></div>
                    <div class="c_d_nodeId"><span class="c_d_blockNumber_nodeId">3</span></div>
                    <div class="s_j"></div>
                </div>
                <div class="c_d_textborder textborder4">
                    <div class="c_d_blockNumber">区块高度：<span class="c_d_blockNumber_number">0</span></div>
                    <div class="c_d_nodeId"><span class="c_d_blockNumber_nodeId">4</span></div>
                    <div class="s_j"></div>
                </div>
            </div>
            <div class="c_d_api">
                <div>
                    <div class="c_d_a_img">
                        <img src="./asstes/7.png" style="height:100%;width: 100%;" alt="">
                    </div>
                    <div class="c_d_a_title">操作日志</div>
                    <div class="c_d_a_latestBlock">latestBlock：<span class="c_d_a_latestBlock_value">0</span></div>
                    <div class="c_d_a_totalNumber">totalNumbe：<span class="c_d_a_totalNumber_value">0</span></div>
                </div>
                <div>
                    <div class="c_d_a_img">
                        <img src="./asstes/7.png" style="height:100%;width: 100%;" alt="">
                    </div>
                    <div class="c_d_a_title">用户信息</div>
                    <div class="c_d_a_latestBlock">latestBlock：<span class="c_d_a_latestBlock_value">0</span></div>
                    <div class="c_d_a_totalNumber">totalNumbe：<span class="c_d_a_totalNumber_value">0</span></div>
                </div>
                <div>
                    <div class="c_d_a_img">
                        <img src="./asstes/7.png" style="height:100%;width: 100%;" alt="">
                    </div>
                    <div class="c_d_a_title">社区政务</div>
                    <div class="c_d_a_latestBlock">latestBlock：<span class="c_d_a_latestBlock_value">0</span></div>
                    <div class="c_d_a_totalNumber">totalNumbe：<span class="c_d_a_totalNumber_value">0</span></div>
                </div>
                <div>
                    <div class="c_d_a_img">
                        <img src="./asstes/7.png" style="height:100%;width: 100%;" alt="">
                    </div>
                    <div class="c_d_a_title">资源共享</div>
                    <div class="c_d_a_latestBlock">latestBlock：<span class="c_d_a_latestBlock_value">0</span></div>
                    <div class="c_d_a_totalNumber">totalNumbe：<span class="c_d_a_totalNumber_value">0</span></div>
                </div>
                <div>
                    <div class="c_d_a_img">
                        <img src="./asstes/7.png" style="height:100%;width: 100%;" alt="">
                    </div>
                    <div class="c_d_a_title">设备认证</div>
                    <div class="c_d_a_latestBlock">latestBlock：<span class="c_d_a_latestBlock_value">0</span></div>
                    <div class="c_d_a_totalNumber">totalNumbe：<span class="c_d_a_totalNumber_value">0</span></div>
                </div>
            </div>
        </div>
    </div>
    <div class="page_bottom">
        <div class="bottom_content">
            <div class="b_c_icp"></div>
            <div class="b_c_bq">COPYRIGHT © 2020 SFSDJ SFSDF INSTITUTE ALL RIGHTS RESERVED &nbsp;&nbsp; 京ICP备20007654号
            </div>
            <div class="b_c_icp"></div>
        </div>
    </div>
</body>
<script>
    var c_b_number = 0
    var c_b_number_dom = document.getElementsByClassName("c_b_number")[0]
    var work_ids = document.getElementsByClassName('work_class')
    var work_class_point = document.getElementsByClassName('work_class_point')
    var c_d_blockNumber_number = document.getElementsByClassName('c_d_blockNumber_number')
    var c_d_blockNumber_nodeId = document.getElementsByClassName('c_d_blockNumber_nodeId')
    var c_d_a_latestBlock_value = document.getElementsByClassName('c_d_a_latestBlock_value')
    var c_d_a_totalNumber_value = document.getElementsByClassName('c_d_a_totalNumber_value')

    function fadeIn(obj, time) {//淡入函数  
        var startTime = new Date();
        obj.style.opacity = 0;//设置下初始值透明度
        obj.style.display = "block";
        var timer = setInterval(function () {
            var nowTime = new Date();
            var prop = (nowTime - startTime) / time;
            if (prop >= 1) {
                prop = 1;//设置最终系数值
                clearInterval(timer);
            }
            obj.style.opacity = prop;//透明度公式： 初始值+系数*（结束值-初始值）
        }, 13);//每隔13ms执行一次function函数
    };
    function fadeOut(obj, time) { // 淡出函数 
        var startTime = new Date();
        obj.style.opacity = 1;//设置下初始值透明度
        obj.style.display = "block";
        var timer = setInterval(function () {
            var nowTime = new Date();
            var prop = (nowTime - startTime) / time;
            if (prop >= 1) {
                prop = 1;//设置最终系数值
                clearInterval(timer);
            }
            obj.style.opacity = 1 + prop * (0 - 1);//透明度公式： 初始值+系数*（结束值-初始值）
        }, 13);//每隔13ms执行一次function函数
    };
    function bannerMove() { // banner动画
        var dom = document.getElementsByClassName('c_b_img')[0]
        var timeout = setInterval(() => {
            dom.style.left = dom.offsetLeft + (-1) + 'px';;
            if (dom.style.left === '-134px') {
                dom.style.left = '0px';
                clearInterval(timeout)
            }
            if (dom.style.left === '0px') {
                work_ids[0].style.opacity = 1
                work_class_point[0].style.opacity = 1
            }
        }, 1);
    }
    function GetValueChange() { // 获取轮播数据
        $.ajax({
            url: "http://106.15.176.60:9191/api/v1/blockNumber",
            type: "get",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            success: function (result) {
                if (c_b_number != result) {
                    fadeOut(work_ids[0], 500)
                    fadeOut(work_class_point[0], 300)
                    fadeIn(work_class_point[5], 1000)
                    fadeIn(work_ids[6], 1000)
                    bannerMove()
                }
                var timer = setTimeout(() => {
                    GetValueChange()
                    clearTimeout(timer)
                }, 5000);
                c_b_number = result
                c_b_number_dom.innerHTML = c_b_number;
                for (var i = 0; i < work_ids.length; i++) {
                    work_ids[i].id = c_b_number - 5 + i
                }

            },
        });
    }
    function GetBlockNumber() {  // 获取区块信息
        $.ajax({
            url: "http://106.15.176.60:9191/api/v1/sync/status",
            type: "get",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            success: function (result) {
                var timer = setTimeout(() => {
                    GetBlockNumber()
                    clearTimeout(timer)
                }, 5000);
                const list = []
                const nodeId = result.nodeId ? result.nodeId.substring(0, 6) + '...' + result.nodeId.substring(result.nodeId.length - 6, result.nodeId.length) : ''
                list.push({ blockNumber: result.blockNumber, nodeId: nodeId })
                const peerList = result.peers
                for (let i = 0; i < peerList.length; i++) {
                    const nodeId = peerList[i].nodeID ? peerList[i].nodeID.substring(0, 6) + '...' + peerList[i].nodeID.substring(peerList[i].nodeID.length - 6, peerList[i].nodeID.length) : ''
                    list.push({ blockNumber: peerList[i].blockNumber, nodeId: nodeId })
                }
                for (let k = 0; k < list.length; k++) {
                    c_d_blockNumber_number[k].innerHTML = list[k].blockNumber
                    c_d_blockNumber_nodeId[k].innerHTML = list[k].nodeId
                }
            },
        });
    }
    function GetLatestBlockNumber(){ //获取底部信息
        $.ajax({
            url: "http://106.15.176.60:9191/api/v1/service/stat?name=whatever",
            type: "get",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            success: function (result) {
                var timer = setTimeout(() => {
                    GetLatestBlockNumber()
                    clearTimeout(timer)
                }, 5000);
                let latestBlock = result.latestBlock
                let totalNumber = result.totalNumber
                for(var i=0;i<c_d_a_latestBlock_value.length;i++){
                    c_d_a_latestBlock_value[i].innerHTML = latestBlock
                }
                for(var i=0;i<c_d_a_totalNumber_value.length;i++){
                    c_d_a_totalNumber_value[i].innerHTML = totalNumber
                }
            },
        });
    }
    $('.work_class').mouseover(function (params) {
        var id = $(this)[0].id
        var index = $('.work_class').index(this)
        $.ajax({
            url: `http://106.15.176.60:9191/api/v1/blockDetailByNumber?number=${id}`,
            type: "get",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            success: function (result) {
                const hash = result.hash
                $('.work_class')[index].title = 'hash：' + hash
            },
        });
    })
    GetValueChange()
    GetBlockNumber()
    GetLatestBlockNumber()
</script>

</html>